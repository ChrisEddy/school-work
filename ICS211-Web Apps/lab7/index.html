<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lab 7</title>
  <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>
<body>

<div id="App"></div>

<script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>

<script type="text/babel">

  class FavSites extends React.Component {

    // run json server: json-server --watch sites.json

    constructor(props) {
      super(props);
      this.state = {
        sites: [],
        checkboxGroup: [false, false, false],
        showForm: true
      };
      this.handleChange = this.handleChange.bind(this);
      this.submit = this.submit.bind(this);
    }

    handleChange(index){
      let tempArray = this.state.checkboxGroup;
      if(this.state.checkboxGroup[index]){
        tempArray[index] = false;
        this.setState({checkboxGroup: tempArray});
      }
      else{
        tempArray[index] = true;
        this.setState({checkboxGroup: tempArray});
      }
      console.log(this.state.checkboxGroup)
    }

    submit(){
      this.setState({showForm: false});
    }

    componentDidMount(){
      fetch('http://localhost:3000/sites')
        .then(response => this.handleHTTPErrors(response))
        .then(response => response.json())
        .then(result => {
          this.setState({
            sites: result
          });
        })
        .catch(error => {
          console.log(error)
        })
    }

    handleHTTPErrors(response){
      if(!response.ok) throw Error(response.status +
      ': ' + response.statusText);
      return response;
    }

    render() {

      const FavSitesForm = () => {
        return(
          <div>
            <p>Solar System</p>
            <input onChange={() => this.handleChange(0)} checked={this.state.checkboxGroup[0]} type="checkbox" name="SolarSystem" value="0"/>
            <p>Gunters of Oasis</p>
            <input onChange={() => this.handleChange(1)} checked={this.state.checkboxGroup[1]} type="checkbox" name="Gunters" value="1"/>
            <p>A-Painter</p>
            <input onChange={() => this.handleChange(2)} checked={this.state.checkboxGroup[2]} type="checkbox" name="A-Painter" value="2"/>
            <input onClick={() => this.submit()} type="submit" value="Submit"/>
          </div>
         )
      };

      const favSitesStyle = {
        height: 300,
        width: 600,
        padding: 20 ,
        backgroundColor: '#FFF2CC',
        boxShadow: '0px 0px 5px #666'
      };

      const Site = (props) => {
        if(props.checked === true){
          return(
            <div style={props.SiteColor}>
              <li>{props.Title}<a href={props.Link}>{props.Link}</a></li>
            </div>
          )
        }
        else{
          return(
            null
          )
        }
      };

      const Title = (props) => {
        const titleStyle = {
          fontFamily: 'Helvetica',
          color: 'blue',
          fontSize: 18,
          textDecoration: 'underline'
        };
        return(
          <div style={titleStyle}>
            <h1>My Favorite WebVR Sites</h1>
            <h3>Look at these cool sites:</h3>
          </div>
        )
      };

      if(this.state.showForm === false){
        return(
          <div style={favSitesStyle}>
            <Title/>
            <ol>
              {this.state.sites.map(sites =>
                <Site key={sites.id} checked={sites.checked} Title={sites.name} Link={sites.link}
                      SiteColor={{color: sites.color}}/>
              )}
            </ol>
          </div>
        )
      }
      else{
        return(
          <FavSitesForm/>
        )
      }

    }
  }

  ReactDOM.render(
    <div style={{"marginLeft": 25 + "%"}}>
      <FavSites/>
    </div>,
    document.getElementById('App')
  )

</script>

</body>
</html>
